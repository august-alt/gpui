name: gpui-test

on:
  workflow_run:
    workflows: [ gpui-build-container ]
    types:
      - completed

jobs:
  gpui-test:
    runs-on: ubuntu-20.04
    container: ghcr.io/${{ github.repository }}:latest

    steps:
      - name: Test
        env:
          QT_QPA_PLATFORM: offscreen
        run: |
          cd /app/
          cmake -B build -DCMAKE_BUILD_TYPE:STRING=Debug -DGPUI_BUILD_TESTS:BOOL=ON .
          cd build
          make -j `nproc`
          make test
